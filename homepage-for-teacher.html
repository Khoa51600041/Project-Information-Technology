<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>homepage-for-teacher</title>
    <!-- Add CSS -->
    <link rel="stylesheet" href="css/homepage.css">
    <!-- Custom Boostrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>

<body>
    <div class="container-fluid">
        <br />
        <form method="post" id="user_form">
            <div class="table-responsive">
                <table class="table table-striped table-bordered" id="user_data">
                    <tr>
                        <th>Mã đề tài</th>
                        <th>Tên đề tài</th>
                        <th>Loại đề tài</th>
                        <th>Mã Giảng Viên</th>
                        <th>Ngày bổ sung</th>
                        <th>Số lượng nhóm được đăng kí</th>
                        <th>Số lượng sinh viên mỗi nhóm</th>
                        <th>Ngày bắt đầu</th>
                        <th>Ngày kết thúc</th>
                        <th>Đợt đăng kí</th>
                        <th>Review</th>
                        <th>Xoá</th>
                    </tr>
                </table>
            </div>
            <div align="center">
                <button type="button" name="add" id="add" class="btn btn-success btn-xs">Thêm Đề Tài</button>
                <input type="submit" name="insert" id="insert" class="btn btn-primary" value="Xong" />
            </div>
        </form>
        <br />
    </div>
    <div id="user_dialog" title="Add Data">
        <!-- Mã đề tài -->
        <div class="form-group">
            <label>Mã đề tài</label>
            <input type="text" name="maDT" id="maDT" class="form-control" />
            <span id="error_maDT" class="text-danger"></span>
        </div>

        <!-- Tên đề tài -->
        <div class="form-group">
            <label>Tên đề tài</label>
            <input type="text" name="tenDT" id="tenDT" class="form-control" />
            <span id="error_tenDT" class="text-danger"></span>
        </div>

        <!-- Loại đề tài -->
        <div class="form-group">
            <label>Loại đề tài</label>
            <input type="text" name="loaiDT" id="loaiDT" class="form-control" />
            <span id="error_loaiDT" class="text-danger"></span>
        </div>

        <!-- Mã giảng giên -->
        <div class="form-group">
            <label>Mã giảng viên</label>
            <input type="text" name="maGV" id="maGV" class="form-control" />
            <span id="error_maGV" class="text-danger"></span>
        </div>

        <!-- Ngày bổ sung -->
        <div class="form-group">
            <label>Ngày bổ sung</label>
            <input type="text" name="ngayBS" id="ngayBS" class="form-control" />
            <span id="error_ngayBS" class="text-danger"></span>
        </div>

        <!-- Số lượng nhóm được đăng kí-->
        <div class="form-group">
            <label>Số lượng nhóm</label>
            <input type="text" name="slNhom" id="slNhom" class="form-control" />
            <span id="error_slNhom" class="text-danger"></span>
        </div>

        <!-- Số lượng sinh viên mỗi nhóm-->
        <div class="form-group">
            <label>Số lượng sinh viên mỗi nhóm</label>
            <input type="text" name="slSV" id="slSV" class="form-control" />
            <span id="error_slSV" class="text-danger"></span>
        </div>

        <!-- Ngày bắt đầu -->
        <div class="form-group">
            <label>Ngày bắt đầu</label>
            <input type="text" name="ngayBD" id="ngayBD" class="form-control" />
            <span id="error_ngayBD" class="text-danger"></span>
        </div>

        <!--  Ngày kết thúc -->
        <div class="form-group">
            <label>Ngày kết thúc</label>
            <input type="text" name="ngayKT" id="ngayKT" class="form-control" />
            <span id="error_ngayKT" class="text-danger"></span>
        </div>

        <!-- Đợt đăng kí -->
        <div class="form-group">
            <label>Đợt đăng kí</label>
            <input type="text" name="dotDK" id="dotDK" class="form-control" />
            <span id="error_dotDK" class="text-danger"></span>
        </div>

        <div class="form-group" align="center">
            <input type="hidden" name="row_id" id="hidden_row_id" />
            <button type="button" name="save" id="save" class="btn btn-info">Save</button>
        </div>
    </div>
    <div id="action_alert" title="Action">

    </div>
</body>

</html>

<script>
    $(document).ready(function () {
        var count = 0;

        $('#user_dialog').dialog({
            autoOpen: false,
            width: 400
        });

        $('#add').click(function () {
            $('#user_dialog').dialog('option', 'title', 'Thêm Đề Tài');
            //new 
            $('#maDT').val('');
            $('#tenDT').val('');
            $('#loaiDT').val('');
            $('#maGV').val('');
            $('#ngayBS').val('');
            $('#slNhom').val('');
            $('#slSV').val('');
            $('#ngayBD').val('');
            $('#ngayKT').val('');
            $('#dotDK').val('');
            //error
            $('#error_maDT').val('');
            $('#error_tenDT').val('');
            $('#error_loaiDT').val('');
            $('#error_maGV').val('');
            $('#error_ngayBS').val('');
            $('#error_slNhom').val('');
            $('#error_slSV').val('');
            $('#error_ngayBD').val('');
            $('#error_ngayKT').val('');
            $('#error_dotDK').val('');

            $('#save').text('Save');
            $('#user_dialog').dialog('open');
        });

        $('#save').click(function () {
            var error_maDT = '';
            var error_tenDT = '';
            var error_loaiDT = '';
            var error_maGV = '';
            var error_ngayBS = '';
            var error_slNhom = '';
            var error_slSV = '';
            var error_ngayBD = '';
            var error_ngayKT = '';
            var error_dotDK = '';

            var maDT = '';
            var tenDT = '';
            var loaiDT = '';
            var maGV = '';
            var ngayBS = '';
            var slNhom = '';
            var slSV = '';
            var ngayBD = '';
            var ngayKT = '';
            var dotDK = '';

            if ($('#first_name').val() == '') {
                error_first_name = 'First Name is required';
                $('#error_first_name').text(error_first_name);
                $('#first_name').css('border-color', '#cc0000');
                first_name = '';
            } else {
                error_first_name = '';
                $('#error_first_name').text(error_first_name);
                $('#first_name').css('border-color', '');
                first_name = $('#first_name').val();
            }
            if ($('#last_name').val() == '') {
                error_last_name = 'Last Name is required';
                $('#error_last_name').text(error_last_name);
                $('#last_name').css('border-color', '#cc0000');
                last_name = '';
            } else {
                error_last_name = '';
                $('#error_last_name').text(error_last_name);
                $('#last_name').css('border-color', '');
                last_name = $('#last_name').val();
            }
            if (error_first_name != '' || error_last_name != '') {
                return false;
            } else {
                if ($('#save').text() == 'Save') {
                    count = count + 1;
                    output = '<tr id="row_' + count + '">';
                    output += '<td>' + first_name +
                        ' <input type="hidden" name="hidden_first_name[]" id="first_name' + count +
                        '" class="first_name" value="' + first_name + '" /></td>';
                    output += '<td>' + last_name +
                        ' <input type="hidden" name="hidden_last_name[]" id="last_name' + count +
                        '" value="' + last_name + '" /></td>';
                    output +=
                        '<td><button type="button" name="view_details" class="btn btn-warning btn-xs view_details" id="' +
                        count + '">View</button></td>';
                    output +=
                        '<td><button type="button" name="remove_details" class="btn btn-danger btn-xs remove_details" id="' +
                        count + '">Remove</button></td>';
                    output += '</tr>';
                    $('#user_data').append(output);
                } else {
                    var row_id = $('#hidden_row_id').val();
                    output = '<td>' + first_name +
                        ' <input type="hidden" name="hidden_first_name[]" id="first_name' + row_id +
                        '" class="first_name" value="' + first_name + '" /></td>';
                    output += '<td>' + last_name +
                        ' <input type="hidden" name="hidden_last_name[]" id="last_name' + row_id +
                        '" value="' + last_name + '" /></td>';
                    output +=
                        '<td><button type="button" name="view_details" class="btn btn-warning btn-xs view_details" id="' +
                        row_id + '">View</button></td>';
                    output +=
                        '<td><button type="button" name="remove_details" class="btn btn-danger btn-xs remove_details" id="' +
                        row_id + '">Remove</button></td>';
                    $('#row_' + row_id + '').html(output);
                }

                $('#user_dialog').dialog('close');
            }
        });

        $(document).on('click', '.view_details', function () {
            var row_id = $(this).attr("id");
            var first_name = $('#first_name' + row_id + '').val();
            var last_name = $('#last_name' + row_id + '').val();
            $('#first_name').val(first_name);
            $('#last_name').val(last_name);
            $('#save').text('Edit');
            $('#hidden_row_id').val(row_id);
            $('#user_dialog').dialog('option', 'title', 'Edit Data');
            $('#user_dialog').dialog('open');
        });

        $(document).on('click', '.remove_details', function () {
            var row_id = $(this).attr("id");
            if (confirm("Are you sure you want to remove this row data?")) {
                $('#row_' + row_id + '').remove();
            } else {
                return false;
            }
        });

        $('#action_alert').dialog({
            autoOpen: false
        });

        $('#user_form').on('submit', function (event) {
            event.preventDefault();
            var count_data = 0;
            $('.first_name').each(function () {
                count_data = count_data + 1;
            });
            if (count_data > 0) {
                var form_data = $(this).serialize();
                $.ajax({
                    url: "insert.php",
                    method: "POST",
                    data: form_data,
                    success: function (data) {
                        $('#user_data').find("tr:gt(0)").remove();
                        $('#action_alert').html('<p>Data Inserted Successfully</p>');
                        $('#action_alert').dialog('open');
                    }
                })
            } else {
                $('#action_alert').html('<p>Please Add atleast one data</p>');
                $('#action_alert').dialog('open');
            }
        });

    });
</script>